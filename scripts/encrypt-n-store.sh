#!/bin/bash
set -e

# –®–ª—è—Ö –¥–æ –ø–∞–ø–∫–∏ —Å–∫—Ä–∏–ø—Ç—ñ–≤
SCRIPT_DIR="./scripts"

# 1. –®–∏—Ñ—Ä—É—î–º–æ –Ω–æ–≤—ñ –∞–±–æ –∑–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏
echo "[üîê] –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤..."
bash "$SCRIPT_DIR/encrypt-unencrypted.sh"

# 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ —î –∑–º—ñ–Ω–∏ –≤ git
if [[ -n $(git status --porcelain) ]]; then
    echo "[üì¶] –Ñ –∑–º—ñ–Ω–∏, –¥–æ–¥–∞—é —É git..."
    git add *.md.age
    git commit -m "Encrypted & committed on $(date '+%Y-%m-%d %H:%M:%S')"
else
    echo "[‚úî] –ù–µ–º–∞—î –Ω–æ–≤–∏—Ö –∑–º—ñ–Ω ‚Äî –≤—Å–µ –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É —Å—Ç–∞–Ω—ñ"
fi

# 3. (–û–ø—Ü—ñ–π–Ω–æ) –ø—É—à —É –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
if git remote | grep -q origin; then
    echo "[‚òÅÔ∏è] –ü—É—à—É —É –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π..."
    git push origin main
else
    echo "[‚ÑπÔ∏è] –í—ñ–¥–¥–∞–ª–µ–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π. –ü—Ä–æ–ø—É—Å–∫–∞—é push"
fi

echo "[‚úÖ] –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
